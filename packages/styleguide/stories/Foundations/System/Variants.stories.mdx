import title from '@codecademy/macros/lib/title.macro';
import { Meta } from '@storybook/addon-docs/blocks';

<Meta
  title={title}
  parameters={{
    subtitle:
      'The variant API lets you conditionally add complex styles to any component with a single prop.',
    source: 'gamut-styles',
    status: 'updating',
  }}
/>

## `css`

A standalone theme aware method that accepts an object of system props and returns the correct style object. It is cached after being called with theme once, preventing more expensive calculations.

**Usage**

```tsx
import { css } from '@codecademy/gamut-styles';

const CoolStuff = styled.a(
  css({
    margin: [16, 24],
  })
);
```

## `variant`

Built on top of `css` that accepts a number of mutually exclusive states a component can be in. Options include:

- `prop`: The prop key that variants should be. Defaults to `variant`.
- `defaultVariant`: The default variant that will be used if none is specified.
- `base`: A system CSS object that is shared (and overrided) by all variants. This will not be applied if no variant / default variant has been specified.
- `variants` (required): A map of keys to each possible state.
  - `key`: The name of the variant to be a possible option of the prop.
  - `value`: The system CSS Object to be applied if the variant has been selected.

**Usage**

```tsx
import { variant } from '@codecademy/gamut-styles';

const Anchor = styled.a(
  variant({
    defaultVariant: 'interface',
    variants: {
      interface: {
        color: 'text',
      },
      inline: {
        color: 'primary',
      },
    },
  })
);
```

## Property Passthrough

In addition to system props, both of these functions permit configurations with any valid CSS property that has not been overridden. These properties are typed to their [CSSType](https://github.com/frenic/csstype#csstype) defaults and will not accept values with the responsive syntax.

When generating the styles the function will ignore the all props that have not been configured directly to the resulting CSSObject.

```tsx
const List = styled.ul(
  variant({
    key: 'listVariant',
    variants: {
      vertical: {
        listStyle: 'none', // Valid!
        p: 0,
        m: 0,
      },
      emoji: {
        listStyleType: '\1F44D', // Valid!
        pr: [12, 24],
        m: 0,
      },
    },
  })
);
```

Output:

```css
.List_vertical {
  list-style: none;
  padding: 0;
  margin: 0;
}

.List_emoji {
  list-style-type: '\1F44D';
  padding-right: 0.75rem;
  margin: 0;
}

@media screen and (min-width: 480px) {
  .List_emoji {
    padding-right: 1.5rem;
  }
}
```

### Conflicting properties

Properties that are handled by a system prop with a shorthand will still be available and may result in unexpected styles (property ordering may differ between conflicts and is not guarnateed to be consistent).

While it is **highly encouraged** to use system properties in all cases, there may be times where you need specific values that are outside of the contraints of normal system properties. In this event **do not** specify both properties and pick the only one that you need.

```tsx
import { css } from '@codecademy/gamut-styles';

// Wrong - Combining both properties
const styles = css({
  mx: 4,
  margin: '128.54px',
});

// Right - Use one or the other
const option1 = css({
  mx: 4, // Pick me!
});

const option2 = css({
  margin: '128.54px', // No Pick Me!
});
```

## Selector Syntax

All `css` and `variant` functions are typed to accept a single level of selectors.

1. If the style key matches a defined system prop it will allow the responsive syntax
2. If it is a valid CSS property it will allow any valid CSSType value for the property.
3. If it is none of these we assume that it is a valid selector and accept a valid configuration of 1 & 2.

This lets you specify scoped selector syntax for anything not matching a valid CSS prop or system property. This with the addition of the CSS Passthrough will allows us to create complete variants for much more complex css as scale. And create robust sharable utilities.

```tsx
const Anchor = styled.a(
  variant({
    variants: {
      interface: {
        color: 'navy',
        '&:hover': {
          textDecoration: 'none',
          border: '2px solid currentColor',
          borderWidth: { md: '4px' }, // nested responsive syntax!
        },
      },
      inline: {
        color: 'hyper',
        transition: 'scale 150ms ease',
        '&:hover': {
          textDecoration: 'underline',
          transform: 'scale(1.2)', // static properties work here too!
        },
      },
    },
  })
);
```

### Typings

```tsx
export type SelectorMap<Props, System> = {
  [K in keyof Props]?: SelectorProps<Props[K], System>;
};

export type SelectorProps<Props, System> = {
  [K in keyof Props]?: K extends keyof System
    ? System[K] // System Property Types
    : K extends keyof PropertyTypes
    ? PropertyTypes[K] // Any Valid CSS Prop
    : Omit<PropertyTypes, keyof System> & System; // No Match Opens a single level of nesting for System + General CSS;
};
```
