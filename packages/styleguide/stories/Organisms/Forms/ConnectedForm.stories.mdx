import { ConnectedForm } from '@codecademy/gamut';
import title from '@codecademy/macros/lib/title.macro';
import { PropsTable } from '@codecademy/storybook-addon-variance';
import { Canvas, Meta, Story } from '@storybook/addon-docs/blocks';

import {
  FancyConnectedFormExample,
  VeryCoolForm,
} from './ConnectedForm.examples';

<Meta
  title={title}
  component={ConnectedForm}
  parameters={{
    subtitle: 'ConnectedForm is a flexible way to build unconventional forms.',
    source: 'gamut',
    status: 'updating',
  }}
/>

`ConnectedForm` is an organism designed to create less conventional forms with all of the reliability of `GridForm` without the strict grid structure.

<Canvas>
  <Story
    name="ConnectedForm"
    args={{ validation: 'onSubmit', resetOnSubmit: true }}
  >
    {(args) => <VeryCoolForm />}
  </Story>
</Canvas>

<PropsTable
  of={ConnectedForm}
  include={[
    'onSubmit',
    'defaultValues',
    'validationRules',
    'validation',
    'disableFieldsOnSubmit',
    'resetOnSubmit',
    'wasSubmitSuccessful',
  ]}
/>

# useConnectedForm

The primary access pattern of `ConnectedForm` is the `useConnectedForm` hook which composes a typesafe version of `ConnectedForm` + `ConnectedFormGroup` from the `defaultValues` passed to it - catching errors before the development enviroment is even started.

Each of your fields' names must correspond with the appropriate `defaultValue` key. `validationRules` operates similarly - each key must correspond to a key in `defaultValue` and must follow [react-hook-form's](https://react-hook-form.com) [validation patterns](https://react-hook-form.com/v6/api#register).

For instance:

```tsx
export const BadForm = () => {
  const {
    ConnectedFormGroup,
    ConnectedForm,
    connectedFormProps,
  } = useConnectedForm({
    defaultValues: {
      thisField: true,
      thatField: 'zero',
      anotherField: 'state your name.',
    },
    validationRules: {
      thisField: { required: 'you need to check this.' },
      //you'll get a type error here because the name isn't found in your default values
      randomField: {
        pattern: {
          value: /^(?:(?!zero).)*$/,
          message: 'literally anything but zero',
        },
      },
    },
  });

  return (
    <ConnectedForm
      //onSubmit is also properly typed!
      onSubmit={({ thisField }) => console.log(thisField)}
      resetOnSubmit
      {...connectedFormProps}
    >
      <SubmitButton>submit this form.</SubmitButton>
      <ConnectedFormGroup
        name="thisField"
        label="cool checkbox bruh"
        field={{
          component: ConnectedCheckbox,
          label: 'check it ouuut',
        }}
      />
      <ConnectedFormGroup
        //another type error, we don't have that name in our defaultValues :(
        name="anotherRandomField"
        label="cool select dude"
        field={{
          component: ConnectedSelect,
          options: ['one', 'two', 'zero'],
        }}
      />
      <ConnectedFormGroup
        name="anotherField"
        label="cool input"
        field={{
          component: ConnectedInput,
          icon: TerminalIcon,
        }}
      />
    </ConnectedForm>
  );
};
```

## ConnectedFormGroup

`ConnectedFormGroup` ensure that every field has proper error handling and accessibility. It also has its own TypeScript magic -- it will type its `field` to the proper ConnectedForm input passed into `component`.

```tsx
export const VeryCoolForm = () => {
  const {
    ConnectedFormGroup,
    ConnectedForm,
    connectedFormProps,
  } = useConnectedForm({
    defaultValues: {
      thisField: true,
      thatField: 'zero',
      anotherField: 'state your name.',
    },
    validationRules: {
      thisField: { required: 'you need to check this.' },
      thatField: {
        pattern: {
          value: /^(?:(?!zero).)*$/,
          message: 'literally anything but zero',
        },
      },
    },
  });
  return (
    <Background bg="background" p={48}>
      <ConnectedForm
        onSubmit={({ thisField }) => console.log(thisField)}
        resetOnSubmit
        {...connectedFormProps}
      >
        <Text>I have something important to tell you...</Text>
        <SubmitButton variant="secondary" m={8}>
          submit this form.
        </SubmitButton>
        <ConnectedFormGroup
          name="thisField"
          label="cool"
          field={{
            component: ConnectedCheckbox,
            label: 'check it ouuut',
          }}
        />
        <ConnectedFormGroup
          name="thatField"
          label="cool"
          field={{
            component: ConnectedSelect,
            options: ['one', 'two', 'zero'],
          }}
        />
        <ConnectedFormGroup
          name="anotherField"
          label="cool"
          field={{
            component: ConnectedInput,
            icon: TerminalIcon,
          }}
        />
      </ConnectedForm>
    </Background>
  );
};
```

## Example

<Canvas>
  <Story
    name="ConnectedForm Example"
    args={{ validation: 'onSubmit', resetOnSubmit: true }}
  >
    {(args) => <FancyConnectedFormExample />}
  </Story>
</Canvas>
5
