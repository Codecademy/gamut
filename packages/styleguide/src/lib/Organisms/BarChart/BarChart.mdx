import { Canvas, Controls, Meta } from '@storybook/blocks';

import { ComponentHeader, LinkTo } from '~styleguide/blocks';

import * as BarChartStories from './BarChart.stories';

export const parameters = {
  subtitle: `A horizontal bar chart for visualizing comparative data`,
  design: {
    type: 'figma',
    url: 'https://www.figma.com/design/ReGfRNillGABAj5SlITalN/%F0%9F%93%90-Gamut?node-id=55123-4176',
  },
  status: 'current',
  source: {
    repo: 'gamut',
    githubLink:
      'https://github.com/Codecademy/gamut/blob/main/packages/gamut/src/BarChart',
  },
};

<Meta of={BarChartStories} />;

<ComponentHeader {...parameters} />

## Usage

Use BarChart to display comparative data across categories, such as skills progress, XP earned, or any quantitative metrics that benefit from visual comparison.

### Best practices:

- Use consistent units across all bars in a chart
- Limit the number of bars to maintain readability (5-10 is optimal)
- Consider using the stacked variant to show progress toward a goal
- Sort bars by value (descending) when ranking is important

When NOT to use

- For showing trends over time - use a line chart instead
- For showing parts of a whole - use a pie or donut chart
- For very small datasets (1-2 items) - consider using ProgressBar

## Variants

### Simple (Non-stacked)

Use the simple variant when showing single values per category. Only `seriesOneValue` is provided.

<Canvas of={BarChartStories.Default} />

### Stacked

Use the stacked variant when showing progress within a total. Provide both `seriesOneValue` (progress) and `seriesTwoValue` (total).

<Canvas of={BarChartStories.Stacked} />

### With Icons

Add icons to labels for better visual identification of categories.

<Canvas of={BarChartStories.WithIcons} />

### Animated

Enable entrance animations for a more engaging experience.

<Canvas of={BarChartStories.Animated} />

### Interactive

Rows can be made interactive with `onClick` handlers or `href` links.

<Canvas of={BarChartStories.Interactive} />

When a bar has an `onClick` handler or `href` link, an `aria-label` is **required** for accessibility. This label is applied to the button or link element and should clearly describe the action or destination.

**Best practices for `aria-label` text:**

- **Be specific and action-oriented**: Describe what will happen when the user interacts with the bar

  - ✅ Good: `"View Python course details"`, `"Go to JavaScript course page"`
  - ❌ Avoid: `"Python"`, `"Click here"`, `"Link"`

- **Include context**: Reference the bar's category or data when relevant

  - ✅ Good: `"View Python course details"`, `"Go to JavaScript course page"`
  - ❌ Avoid: Generic labels that don't relate to the specific bar

- **Match user intent**: Use language that matches the action (view, navigate, edit, etc.)

  - For buttons (`onClick`): Focus on the action, e.g., `"View Python course details"`, `"Edit JavaScript progress"`
  - For links (`href`): Focus on the destination, e.g., `"Go to Python course page"`, `"Navigate to JavaScript dashboard"`

- **Keep it concise**: Aim for 5-10 words that clearly communicate the purpose

Note: The `aria-label` on the interactive element (button/link) is separate from the automatically generated `valuesSummary` that appears on the list item. Both serve different accessibility purposes - the interactive element's label describes the action, while the list item's label describes the data.

<Canvas of={BarChartStories.WithLinks} />

## Accessibility considerations

### Chart and row labeling

**Chart-level labeling:**

- Always provide either `title` or `aria-labelledby` to describe the chart (see Title and description section below for details)
- The chart is wrapped in a semantic `<figure>` element for proper structure

**Row-level labeling:**

- Each row automatically generates an accessible label summarizing its values (e.g., "100 XP in Python category")
- Interactive rows (with `onClick` or `href`) are properly announced as buttons/links
- **Interactive rows require an `aria-label`**: When using `onClick` or `href`, you must provide an `aria-label` prop for each interactive bar. This label is applied to the button or link element and should clearly describe the action or destination (see the Interactive section for best practices)

## UX writing

- Keep y-axis labels concise (1-3 words)
- Use consistent unit labels (e.g., "XP", "hours", "points")
- Consider locale-aware number formatting for international audiences

### Title and description

The BarChart component uses semantic HTML to provide context and accessibility. The chart is wrapped in a [`<figure>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figure) element, and the description is displayed in a [`<figcaption>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figcaption) element. This semantic structure helps screen readers and other assistive technologies understand the relationship between the chart and its description. **Visual title + description is the greatly preferred pattern** for accessibility and user experience.

**Preferred pattern: Visual title + description**

Provide both `title` and `description` props to make the chart's purpose and key takeaways clear to all users:

- `title`: A heading that identifies the chart. Can be a string or an object with `{ as?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6', title: string, variant?: Text['variant'] }` to specify the heading level and optionally override the default styling with a <LinkTo id="Typography/Text">Text variant</LinkTo>.
- `description`: A summary of the information or the overall takeaway displayed in the `<figcaption>` element.

<Canvas of={BarChartStories.WithVisualTitleAndDescription} />

**Alternative patterns:**
`hideTitle` and `hideDescription` will keep the screenreader text but hide the visual descriptions.

<Canvas of={BarChartStories.WithHiddenTitleAndDescription} />

- **External title with visual description**: Use `aria-labelledby` for the title but show the description visually when the title exists elsewhere but you want to display the description.

<Canvas of={BarChartStories.WithExternalTitle} />

**Best practices:**

- Always provide a `description` prop - it's required and should summarize the chart's key information
- Use semantic heading levels for titles (h1-h6) to maintain proper document structure
- When using `aria-labelledby`, ensure the referenced element exists and is properly labeled

## Playground

<Canvas sourceState="shown" of={BarChartStories.Default} />

<Controls />
