import { Canvas, Controls, Meta } from '@storybook/blocks';

import { ComponentHeader } from '~styleguide/blocks';

import * as InfoTipStories from './InfoTip.stories';

export const parameters = {
  title: 'InfoTip',
  subtitle: `A tip triggered by clicking on an information icon button. Use an infotip to provide additional info about a nearby element or content.`,
  design: {
    type: 'figma',
    url: 'https://www.figma.com/file/ReGfRNillGABAj5SlITalN/branch/ayKNSg6QvZUjsgw0FFysW4/%F0%9F%93%90-Gamut?type=design&node-id=41538-55277&mode=design&t=fGkWf5GSl5cj5fQo-0',
  },
  status: 'updating',
  source: {
    repo: 'gamut',
    githubLink:
      'https://github.com/Codecademy/gamut/blob/main/packages/gamut/src/Tip/InfoTip/index.tsx',
  },
};

<Meta of={InfoTipStories} />

<ComponentHeader {...parameters} />

## Usage

A tip is triggered by clicking on an information icon button and can be closed by clicking outside, pressing <kbd>Esc</kbd>, or clicking the info button again.

Use an infotip to provide additional info about a nearby element or content.

Infotip consists of an icon button and the .tip-bg subcomponent. The info button has low and high emphasis variants and the `.tip` has 4 alignment variants.

## Variants

### Emphasis

The InfoTip has high and low emphasis variants.

<Canvas of={InfoTipStories.Emphasis} />

### Alignments

InfoTips have four different alignment options: `top-right`, `top-left`, `bottom-right`, and `bottom-left`. They have a consistent size and are meant for longer content. If you need a smaller, more concise component checkout (the upcoming) ToolTip or Link Preview components to see if they fit your use case.

<Canvas of={InfoTipStories.Alignments} />

### Placement

InfoTips sometimes need to be in used in a way that they need to escape the confines of their parent container. The `floating` variant of the `placement` prop allows InfoTips do just this. (Notice how this section doesn't need as much padding because the InfoTips are able to escape their context!)

This `floating` variant should only be used as needed.

<Canvas of={InfoTipStories.Placement} />

## Keyboard navigation & accessibility

### InfoTips with links or buttons

Links or buttons within InfoTips should be used sparingly and only when the information is critical to the user's understanding of the content. If an infotip _absolutely requires_ a link or button, it needs to provide a programmatic focus by way of the `onClick` prop. The `onClick` prop accepts a function that calls the object `{isTipHidden}` and should focus when the tip is visible.

<Canvas of={InfoTipStories.WithLinksOrButtons} />

### Floating placement

When using `placement="floating"`, InfoTips implements focus management for easier navigation:

- **Tab**: Navigate forward through focusable elements (links, buttons) inside the tip. When reaching the last element, wraps back to the InfoTip button for convenience
- **Shift+Tab**: Navigate backward naturally through the page
- **Escape**: Closes the tip and returns focus to the InfoTip button

<Canvas of={InfoTipStories.KeyboardNavigation} />

### Global Escape key handling

InfoTips listen for the Escape key globally and will close automatically **unless** a higher-priority element is open:

- **InfoTips close on Escape** regardless of where keyboard focus is
- **Modals and dialogs take priority** - InfoTips detect when `dialog[open]`, `role="dialog"`, or `role="alertdialog"` elements are present and defer Escape handling to them
- After closing a modal, pressing Escape again will close the InfoTip
- When an InfoTip closes via Escape, focus automatically returns to the InfoTip button

<Canvas of={InfoTipStories.WithModal} />

### InfoTips inside Modals

InfoTips can be placed inside Modal content and will work correctly:

- **InfoTips inside Modals close on Escape first** - When you press Escape, the InfoTip closes but the Modal stays open
- **Pressing Escape again closes the Modal** - This provides proper layered keyboard navigation
- **Focus management works correctly** - Focus returns to the InfoTip button when closed, maintaining proper focus flow within the Modal

<Canvas of={InfoTipStories.InfoTipInsideModal} />

## InfoTips and zIndex

You can change the zIndex of your `InfoTip` with the zIndex property.

<Canvas of={InfoTipStories.ZIndex} />

## Playground

<Canvas sourceState="shown" of={InfoTipStories.Default} />

<Controls />
