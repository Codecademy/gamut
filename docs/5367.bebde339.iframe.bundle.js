"use strict";(self.webpackChunkgamut_repo=self.webpackChunkgamut_repo||[]).push([[5367],{"./node_modules/media-captions/dist/prod.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CaptionsRenderer:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.C,ParseError:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.P,ParseErrorCode:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.c,TextCue:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.T,VTTCue:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.b,VTTRegion:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.h,createVTTCueTemplate:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.i,parseByteStream:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.e,parseResponse:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.d,parseText:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.f,parseTextStream:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.g,parseVTTTimestamp:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.p,renderVTTCueString:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.r,renderVTTTokensString:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.j,tokenizeVTTCue:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.t,updateTimedVTTCueNodes:()=>_prod_index_js__WEBPACK_IMPORTED_MODULE_0__.u});var _prod_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/media-captions/dist/prod/index.js")},"./node_modules/media-captions/dist/prod/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>CaptionsRenderer,P:()=>ParseError,T:()=>TextCue,V:()=>VTTParser,a:()=>VTTBlock,b:()=>VTTCue,c:()=>ParseErrorCode,d:()=>parseResponse,e:()=>parseByteStream,f:()=>parseText,g:()=>parseTextStream,h:()=>VTTRegion,i:()=>createVTTCueTemplate,j:()=>renderVTTTokensString,p:()=>parseVTTTimestamp,r:()=>renderVTTCueString,t:()=>tokenizeVTTCue,u:()=>updateTimedVTTCueNodes});const ParseErrorCode={LoadFail:0,BadSignature:1,BadTimestamp:2,BadSettingValue:3,BadFormat:4,UnknownSetting:5};class ParseError extends Error{code;line;constructor(init){super(init.reason),this.code=init.code,this.line=init.line}}const LINE_TERMINATOR_RE=/\r?\n|\r/gm;class TextLineTransformStream{writable;readable;constructor(encoding){const transformer=new TextStreamLineIterator(encoding);this.writable=new WritableStream({write(chunk){transformer.transform(chunk)},close(){transformer.close()}}),this.readable=new ReadableStream({start(controller){transformer.onLine=line=>controller.enqueue(line),transformer.onClose=()=>controller.close()}})}}class TextStreamLineIterator{a="";b;onLine;onClose;constructor(encoding){this.b=new TextDecoder(encoding)}transform(chunk){this.a+=this.b.decode(chunk,{stream:!0});const lines=this.a.split(LINE_TERMINATOR_RE);this.a=lines.pop()||"";for(let i=0;i<lines.length;i++)this.onLine(lines[i].trim())}close(){this.a&&this.onLine(this.a.trim()),this.a="",this.onClose()}}async function parseText(text,options){return parseTextStream(new ReadableStream({start(controller){const lines=text.split(LINE_TERMINATOR_RE);for(const line of lines)controller.enqueue(line);controller.close()}}),options)}async function parseTextStream(stream,options){const type=options?.type??"vtt";let factory,result;if("string"==typeof type)switch(type){case"srt":factory=(await __webpack_require__.e(379).then(__webpack_require__.bind(__webpack_require__,"./node_modules/media-captions/dist/prod/srt-parser.js"))).default;break;case"ssa":case"ass":factory=(await __webpack_require__.e(8169).then(__webpack_require__.bind(__webpack_require__,"./node_modules/media-captions/dist/prod/ssa-parser.js"))).default;break;default:factory=(await Promise.resolve().then((function(){return vttParser}))).default}else factory=type;const reader=stream.getReader(),parser=factory(),errors=!!options?.strict||!!options?.errors;await parser.init({strict:!1,...options,errors,type,cancel(){reader.cancel(),result=parser.done(!0)}});let i=1;for(;;){const{value,done}=await reader.read();if(done){parser.parse("",i),result=parser.done(!1);break}parser.parse(value,i),i++}return result}async function parseResponse(response,options){const res=await response;if(!res.ok||!res.body){let error;return{metadata:{},cues:[],regions:[],errors:[error]}}const contentType=res.headers.get("content-type")||"",type=contentType.match(/text\/(.*?)(?:;|$)/)?.[1],encoding=contentType.match(/charset=(.*?)(?:;|$)/)?.[1];return parseByteStream(res.body,{type,encoding,...options})}async function parseByteStream(stream,{encoding="utf-8",...options}={}){return parseTextStream(stream.pipeThrough(new TextLineTransformStream(encoding)),options)}class TextCue extends EventTarget{id="";startTime;endTime;text;pauseOnExit=!1;constructor(startTime,endTime,text){super(),this.startTime=startTime,this.endTime=endTime,this.text=text}addEventListener(type,listener,options){super.addEventListener(type,listener,options)}removeEventListener(type,listener,options){super.removeEventListener(type,listener,options)}}const IS_SERVER="undefined"==typeof document,CueBase=IS_SERVER?TextCue:window.VTTCue;class VTTCue extends CueBase{region=null;vertical="";snapToLines=!0;line="auto";lineAlign="start";position="auto";positionAlign="auto";size=100;align="center";style}class VTTRegion{id="";width=100;lines=3;regionAnchorX=0;regionAnchorY=100;viewportAnchorX=0;viewportAnchorY=100;scroll=""}function toNumber(text){const num=parseInt(text,10);return Number.isNaN(num)?null:num}function toPercentage(text){const num=parseInt(text.replace("%",""),10);return!Number.isNaN(num)&&num>=0&&num<=100?num:null}function toCoords(text){if(!text.includes(","))return null;const[x,y]=text.split(",").map(toPercentage);return null!==x&&null!==y?[x,y]:null}function toFloat(text){const num=parseFloat(text);return Number.isNaN(num)?null:num}const SETTING_SEP_RE=/[:=]/,SETTING_LINE_RE=/^[\s\t]*(region|vertical|line|position|size|align)[:=]/,REGION_BLOCK_START_RE=/^REGION:?[\s\t]+/,SPACE_RE=/[\s\t]+/,TIMESTAMP_SEP_RE=/[\s\t]*-->[\s\t]+/,ALIGN_RE=/start|center|end|left|right/,LINE_ALIGN_RE=/start|center|end/,POS_ALIGN_RE=/line-(?:left|right)|center|auto/,TIMESTAMP_RE=/^(?:(\d{1,2}):)?(\d{2}):(\d{2})(?:\.(\d{1,3}))?$/;var VTTBlock=(VTTBlock2=>(VTTBlock2[VTTBlock2.None=0]="None",VTTBlock2[VTTBlock2.Header=1]="Header",VTTBlock2[VTTBlock2.Cue=2]="Cue",VTTBlock2[VTTBlock2.Region=3]="Region",VTTBlock2[VTTBlock2.Note=4]="Note",VTTBlock2))(VTTBlock||{});class VTTParser{h;e=0;i={};j={};l=[];c=null;d=null;m=[];f;n="";async init(init){this.h=init,init.strict&&(this.e=1),init.errors&&(this.f=(await __webpack_require__.e(5457).then(__webpack_require__.bind(__webpack_require__,"./node_modules/media-captions/dist/prod/errors.js"))).ParseErrorBuilder)}parse(line,lineCount){if(""===line)this.c?(this.l.push(this.c),this.h.onCue?.(this.c),this.c=null):this.d?(this.j[this.d.id]=this.d,this.h.onRegion?.(this.d),this.d=null):1===this.e&&(this.k(line,lineCount),this.h.onHeaderMetadata?.(this.i)),this.e=0;else if(this.e)switch(this.e){case 1:this.k(line,lineCount);break;case 2:if(this.c){const hasText=this.c.text.length>0;!hasText&&SETTING_LINE_RE.test(line)?this.o(line.split(SPACE_RE),lineCount):this.c.text+=(hasText?"\n":"")+line}break;case 3:this.p(line.split(SPACE_RE),lineCount)}else if(line.startsWith("NOTE"))this.e=4;else if(line.startsWith("REGION"))this.e=3,this.d=new VTTRegion,this.p(line.replace(REGION_BLOCK_START_RE,"").split(SPACE_RE),lineCount);else if(line.includes("--\x3e")){const result=this.q(line,lineCount);result&&(this.c=new VTTCue(result[0],result[1],""),this.c.id=this.n,this.o(result[2],lineCount)),this.e=2}else 1===lineCount&&this.k(line,lineCount);this.n=line}done(){return{metadata:this.i,cues:this.l,regions:Object.values(this.j),errors:this.m}}k(line,lineCount){if(lineCount>1){if(SETTING_SEP_RE.test(line)){const[key,value]=line.split(SETTING_SEP_RE);key&&(this.i[key]=(value||"").replace(SPACE_RE,""))}}else line.startsWith("WEBVTT")?this.e=1:this.g(this.f?.r())}q(line,lineCount){const[startTimeText,trailingText=""]=line.split(TIMESTAMP_SEP_RE),[endTimeText,...settingsText]=trailingText.split(SPACE_RE),startTime=parseVTTTimestamp(startTimeText),endTime=parseVTTTimestamp(endTimeText);if(null!==startTime&&null!==endTime&&endTime>startTime)return[startTime,endTime,settingsText];null===startTime&&this.g(this.f?.s(startTimeText,lineCount)),null===endTime&&this.g(this.f?.t(endTimeText,lineCount)),null!=startTime&&null!==endTime&&endTime>startTime&&this.g(this.f?.u(startTime,endTime,lineCount))}p(settings,line){let badValue;for(let i=0;i<settings.length;i++)if(SETTING_SEP_RE.test(settings[i])){badValue=!1;const[name,value]=settings[i].split(SETTING_SEP_RE);switch(name){case"id":this.d.id=value;break;case"width":const width=toPercentage(value);null!==width?this.d.width=width:badValue=!0;break;case"lines":const lines=toNumber(value);null!==lines?this.d.lines=lines:badValue=!0;break;case"regionanchor":const region=toCoords(value);null!==region?(this.d.regionAnchorX=region[0],this.d.regionAnchorY=region[1]):badValue=!0;break;case"viewportanchor":const viewport=toCoords(value);null!==viewport?(this.d.viewportAnchorX=viewport[0],this.d.viewportAnchorY=viewport[1]):badValue=!0;break;case"scroll":"up"===value?this.d.scroll="up":badValue=!0;break;default:this.g(this.f?.v(name,value,line))}badValue&&this.g(this.f?.w(name,value,line))}}o(settings,line){let badValue;for(let i=0;i<settings.length;i++)if(badValue=!1,SETTING_SEP_RE.test(settings[i])){const[name,value]=settings[i].split(SETTING_SEP_RE);switch(name){case"region":const region=this.j[value];region&&(this.c.region=region);break;case"vertical":"lr"===value||"rl"===value?(this.c.vertical=value,this.c.region=null):badValue=!0;break;case"line":const[linePos,lineAlign]=value.split(",");if(linePos.includes("%")){const percentage=toPercentage(linePos);null!==percentage?(this.c.line=percentage,this.c.snapToLines=!1):badValue=!0}else{const number=toFloat(linePos);null!==number?this.c.line=number:badValue=!0}LINE_ALIGN_RE.test(lineAlign)?this.c.lineAlign=lineAlign:lineAlign&&(badValue=!0),"auto"!==this.c.line&&(this.c.region=null);break;case"position":const[colPos,colAlign]=value.split(","),position=toPercentage(colPos);null!==position?this.c.position=position:badValue=!0,colAlign&&POS_ALIGN_RE.test(colAlign)?this.c.positionAlign=colAlign:colAlign&&(badValue=!0);break;case"size":const size=toPercentage(value);null!==size?(this.c.size=size,size<100&&(this.c.region=null)):badValue=!0;break;case"align":ALIGN_RE.test(value)?this.c.align=value:badValue=!0;break;default:this.g(this.f?.x(name,value,line))}badValue&&this.g(this.f?.y(name,value,line))}}g(error){if(error){if(this.m.push(error),this.h.strict)throw this.h.cancel(),error;this.h.onError?.(error)}}}function parseVTTTimestamp(timestamp){const match=timestamp.match(TIMESTAMP_RE);if(!match)return null;const hours=match[1]?parseInt(match[1],10):0,minutes=parseInt(match[2],10),seconds=parseInt(match[3],10),milliseconds=match[4]?parseInt(match[4].padEnd(3,"0"),10):0;return hours<0||minutes<0||seconds<0||milliseconds<0||minutes>59||seconds>59?null:3600*hours+60*minutes+seconds+milliseconds/1e3}var vttParser=Object.freeze({__proto__:null,VTTBlock,VTTParser,default:function createVTTParser(){return new VTTParser},parseVTTTimestamp});const DIGIT_RE=/[0-9]/,MULTI_SPACE_RE=/[\s\t]+/,TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span",timestamp:"span"},HTML_ENTITIES={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":" ","&lrm;":"‎","&rlm;":"‏"},HTML_ENTITY_RE=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,COLORS=new Set(["white","lime","cyan","red","yellow","magenta","blue","black"]),BLOCK_TYPES=new Set(Object.keys(TAG_NAME));function tokenizeVTTCue(cue){let node,buffer="",mode=1,result=[],stack=[];for(let i=0;i<cue.text.length;i++){const char=cue.text[i];switch(mode){case 1:"<"===char?(addText(),mode=2):buffer+=char;break;case 2:switch(char){case"\n":case"\t":case" ":addNode(),mode=4;break;case".":addNode(),mode=3;break;case"/":mode=5;break;case">":addNode(),mode=1;break;default:!buffer&&DIGIT_RE.test(char)&&(mode=6),buffer+=char}break;case 3:switch(char){case"\t":case" ":case"\n":addClass(),node&&node.class?.trim(),mode=4;break;case".":addClass();break;case">":addClass(),node&&node.class?.trim(),mode=1;break;default:buffer+=char}break;case 4:">"===char?(buffer=buffer.replace(MULTI_SPACE_RE," "),"v"===node?.type?node.voice=replaceHTMLEntities(buffer):"lang"===node?.type&&(node.lang=replaceHTMLEntities(buffer)),buffer="",mode=1):buffer+=char;break;case 5:">"===char&&(buffer="",node=stack.pop(),mode=1);break;case 6:if(">"===char){const time=parseVTTTimestamp(buffer);null!==time&&time>=cue.startTime&&time<=cue.endTime&&(buffer="timestamp",addNode(),node.time=time),buffer="",mode=1}else buffer+=char}}function addNode(){if(BLOCK_TYPES.has(buffer)){const parent=node;node=function createBlockNode(type){return{tagName:TAG_NAME[type],type,children:[]}}(buffer),parent?(stack[stack.length-1]!==parent&&stack.push(parent),parent.children.push(node)):result.push(node)}buffer="",mode=1}function addClass(){if(node&&buffer){const color=buffer.replace("bg_","");COLORS.has(color)?node[buffer.startsWith("bg_")?"bgColor":"color"]=color:node.class=node.class?node.class+" "+buffer:buffer}buffer=""}function addText(){if(!buffer)return;const text={type:"text",data:replaceHTMLEntities(buffer)};node?node.children.push(text):result.push(text),buffer=""}return 1===mode&&addText(),result}function replaceHTMLEntities(text){return text.replace(HTML_ENTITY_RE,(entity=>HTML_ENTITIES[entity]||"'"))}function setCSSVar(el,name,value){el.style.setProperty(`--${name}`,value+"")}function setDataAttr(el,name,value=!0){el.setAttribute(`data-${name}`,!0===value?"":value+"")}function setPartAttr(el,name){el.setAttribute("data-part",name)}function createVTTCueTemplate(cue){if(IS_SERVER)throw Error("[media-captions] called `createVTTCueTemplate` on the server - use `renderVTTCueString`");const template=document.createElement("template");return template.innerHTML=renderVTTCueString(cue),{cue,content:template.content}}function renderVTTCueString(cue,currentTime=0){return renderVTTTokensString(tokenizeVTTCue(cue),currentTime)}function renderVTTTokensString(tokens,currentTime=0){let attrs,result="";for(const token of tokens)if("text"===token.type)result+=token.data;else{const isTimestamp="timestamp"===token.type;attrs={},attrs.class=token.class,attrs.title="v"===token.type&&token.voice,attrs.lang="lang"===token.type&&token.lang,attrs["data-part"]="v"===token.type&&"voice",isTimestamp&&(attrs["data-part"]="timed",attrs["data-time"]=token.time,attrs["data-future"]=token.time>currentTime,attrs["data-past"]=token.time<currentTime),attrs.style=`${token.color?`color: ${token.color};`:""}${token.bgColor?`background-color: ${token.bgColor};`:""}`;const attributes=Object.entries(attrs).filter((v=>v[1])).map((v=>`${v[0]}="${!0===v[1]?"":v[1]}"`)).join(" ");result+=`<${token.tagName}${attributes?" "+attributes:""}>${renderVTTTokensString(token.children)}</${token.tagName}>`}return result}function updateTimedVTTCueNodes(root,currentTime){if(!IS_SERVER)for(const el of root.querySelectorAll('[data-part="timed"]')){const time=Number(el.getAttribute("data-time"));Number.isNaN(time)||(time>currentTime?setDataAttr(el,"future"):el.removeAttribute("data-future"),time<currentTime?setDataAttr(el,"past"):el.removeAttribute("data-past"))}}const STARTING_BOX=Symbol(0);function createBox(box){return box instanceof HTMLElement?{top:box.offsetTop,width:box.clientWidth,height:box.clientHeight,left:box.offsetLeft,right:box.offsetLeft+box.clientWidth,bottom:box.offsetTop+box.clientHeight}:{...box}}function moveBox(box,axis,delta){switch(axis){case"+x":box.left+=delta,box.right+=delta;break;case"-x":box.left-=delta,box.right-=delta;break;case"+y":box.top+=delta,box.bottom+=delta;break;case"-y":box.top-=delta,box.bottom-=delta}}function isAnyBoxCollision(box,boxes){for(let i=0;i<boxes.length;i++)if(a=box,b=boxes[i],a.left<=b.right&&a.right>=b.left&&a.top<=b.bottom&&a.bottom>=b.top)return boxes[i];var a,b;return null}function isWithinBox(container,box){return box.top>=0&&box.bottom<=container.height&&box.left>=0&&box.right<=container.width}function isBoxOutOfBounds(container,box,axis){switch(axis){case"+x":return box.left<0;case"-x":return box.right>container.width;case"+y":return box.top<0;case"-y":return box.bottom>container.height}}function calcBoxIntersectPercentage(container,box){return Math.max(0,Math.min(container.width,box.right)-Math.max(0,box.left))*Math.max(0,Math.min(container.height,box.bottom)-Math.max(0,box.top))/(container.height*container.width)}function createCSSBox(container,box){return{top:box.top/container.height,left:box.left/container.width,right:(container.width-box.right)/container.width,bottom:(container.height-box.bottom)/container.height}}function resolveRelativeBox(container,box){return box.top=box.top*container.height,box.left=box.left*container.width,box.right=container.width-box.right*container.width,box.bottom=container.height-box.bottom*container.height,box}const BOX_SIDES=["top","left","right","bottom"];function setBoxCSSVars(el,container,box,prefix){const cssBox=createCSSBox(container,box);for(const side of BOX_SIDES)setCSSVar(el,`${prefix}-${side}`,100*cssBox[side]+"%")}function avoidBoxCollisions(container,box,boxes,axis){let positionedBox,percentage=1,startBox={...box};for(let i=0;i<axis.length;i++){for(;isBoxOutOfBounds(container,box,axis[i])||isWithinBox(container,box)&&isAnyBoxCollision(box,boxes);)moveBox(box,axis[i],1);if(isWithinBox(container,box))return box;const intersection=calcBoxIntersectPercentage(container,box);percentage>intersection&&(positionedBox={...box},percentage=intersection),box={...startBox}}return positionedBox||startBox}const POSITION_OVERRIDE=Symbol(0);function positionCue(container,cue,displayEl,boxes){let displayBox,cueEl=displayEl.firstElementChild,line=function computeCueLine(cue){if("auto"===cue.line)return cue.snapToLines?-1:100;return cue.line}(cue),axis=[];if(displayEl[STARTING_BOX]||(displayEl[STARTING_BOX]=function createStartingBox(container,cueEl){const box=createBox(cueEl),pos=function getStyledPositions(el){const positions={};for(const side of BOX_SIDES)positions[side]=parseFloat(el.style.getPropertyValue(`--cue-${side}`));return positions}(cueEl);cueEl[POSITION_OVERRIDE]=!1,pos.top&&(box.top=pos.top,box.bottom=pos.top+box.height,cueEl[POSITION_OVERRIDE]="top");if(pos.bottom){const bottom=container.height-pos.bottom;box.top=bottom-box.height,box.bottom=bottom,cueEl[POSITION_OVERRIDE]="bottom"}pos.left&&(box.left=pos.left);pos.right&&(box.right=container.width-pos.right);return createCSSBox(container,box)}(container,displayEl)),displayBox=resolveRelativeBox(container,{...displayEl[STARTING_BOX]}),displayEl[POSITION_OVERRIDE])axis=["top"===displayEl[POSITION_OVERRIDE]?"+y":"-y","+x","-x"];else if(cue.snapToLines){let size;switch(cue.vertical){case"":axis=["+y","-y"],size="height";break;case"rl":axis=["+x","-x"],size="width";break;case"lr":axis=["-x","+x"],size="width"}let step=function getLineHeight(el){return parseFloat(getComputedStyle(el).lineHeight)||0}(cueEl),position=step*Math.round(line),maxPosition=container[size]+step,initialAxis=axis[0];Math.abs(position)>maxPosition&&(position=position<0?-1:1,position*=Math.ceil(maxPosition/step)*step),line<0&&(position+=""===cue.vertical?container.height:container.width,axis=axis.reverse()),moveBox(displayBox,initialAxis,position)}else{const isHorizontal=""===cue.vertical,posAxis=isHorizontal?"+y":"+x",size=isHorizontal?displayBox.height:displayBox.width;moveBox(displayBox,posAxis,(isHorizontal?container.height:container.width)*line/100),moveBox(displayBox,posAxis,"center"===cue.lineAlign?size/2:"end"===cue.lineAlign?size:0),axis=isHorizontal?["-y","+y","-x","+x"]:["-x","+x","-y","+y"]}return displayBox=avoidBoxCollisions(container,displayBox,boxes,axis),setBoxCSSVars(displayEl,container,displayBox,"cue"),displayBox}const REGION_AXIS=["-y","+y","-x","+x"];function positionRegion(container,region,regionEl,boxes){let cues=Array.from(regionEl.querySelectorAll('[data-part="cue-display"]')),height=0,limit=Math.max(0,cues.length-region.lines);for(let i=cues.length-1;i>=limit;i--)height+=cues[i].offsetHeight;setCSSVar(regionEl,"region-height",height+"px"),regionEl[STARTING_BOX]||(regionEl[STARTING_BOX]=createCSSBox(container,createBox(regionEl)));let box={...regionEl[STARTING_BOX]};return box=resolveRelativeBox(container,box),box.width=regionEl.clientWidth,box.height=height,box.right=box.left+box.width,box.bottom=box.top+height,box=avoidBoxCollisions(container,box,boxes,REGION_AXIS),setBoxCSSVars(regionEl,container,box,"region"),box}class CaptionsRenderer{overlay;z;A=0;C="ltr";B=[];D=!1;E;j=new Map;l=new Map;get dir(){return this.C}set dir(dir){this.C=dir,setDataAttr(this.overlay,"dir",dir)}get currentTime(){return this.A}set currentTime(time){this.A=time,this.update()}constructor(overlay,init){this.overlay=overlay,this.dir=init?.dir??"ltr",overlay.setAttribute("translate","yes"),overlay.setAttribute("aria-live","off"),overlay.setAttribute("aria-atomic","true"),setPartAttr(overlay,"captions"),this.G(),this.E=new ResizeObserver(this.I.bind(this)),this.E.observe(overlay)}changeTrack({regions,cues}){this.reset(),this.J(regions);for(const cue of cues)this.l.set(cue,null);this.update()}addCue(cue){this.l.set(cue,null),this.update()}removeCue(cue){this.l.delete(cue),this.update()}update(forceUpdate=!1){this.H(forceUpdate)}reset(){this.l.clear(),this.j.clear(),this.B=[],this.overlay.textContent=""}destroy(){this.reset(),this.E.disconnect()}I(){this.D=!0,this.K()}K=function debounce(fn,delay){let args,timeout=null;function run(){clear(),fn(...args),args=void 0}function clear(){clearTimeout(timeout),timeout=null}return function debounce2(){args=[].slice.call(arguments),clear(),timeout=setTimeout(run,delay)}}((()=>{this.D=!1,this.G();for(const el of this.j.values())el[STARTING_BOX]=null;for(const el of this.l.values())el&&(el[STARTING_BOX]=null);this.H(!0)}),50);G(){this.z=createBox(this.overlay),setCSSVar(this.overlay,"overlay-width",this.z.width+"px"),setCSSVar(this.overlay,"overlay-height",this.z.height+"px")}H(forceUpdate=!1){if(!this.l.size||this.D)return;let cue,activeCues=[...this.l.keys()].filter((cue2=>this.A>=cue2.startTime&&this.A<=cue2.endTime)).sort(((cueA,cueB)=>cueA.startTime!==cueB.startTime?cueA.startTime-cueB.startTime:cueA.endTime-cueB.endTime)),activeRegions=activeCues.map((cue2=>cue2.region));for(let i=0;i<this.B.length;i++){if(cue=this.B[i],activeCues[i]===cue)continue;if(cue.region&&!activeRegions.includes(cue.region)){const regionEl=this.j.get(cue.region.id);regionEl&&(regionEl.removeAttribute("data-active"),forceUpdate=!0)}const cueEl=this.l.get(cue);cueEl&&(cueEl.remove(),forceUpdate=!0)}for(let i=0;i<activeCues.length;i++){cue=activeCues[i];let cueEl=this.l.get(cue);cueEl||this.l.set(cue,cueEl=this.L(cue));const regionEl=this.F(cue)&&this.j.get(cue.region.id);regionEl&&!regionEl.hasAttribute("data-active")&&(requestAnimationFrame((()=>setDataAttr(regionEl,"active"))),forceUpdate=!0),cueEl.isConnected||((regionEl||this.overlay).append(cueEl),forceUpdate=!0)}if(forceUpdate){const boxes=[],seen=new Set;for(let i=activeCues.length-1;i>=0;i--){if(cue=activeCues[i],seen.has(cue.region||cue))continue;const isRegion=this.F(cue),el=isRegion?this.j.get(cue.region.id):this.l.get(cue);isRegion?boxes.push(positionRegion(this.z,cue.region,el,boxes)):boxes.push(positionCue(this.z,cue,el,boxes)),seen.add(isRegion?cue.region:cue)}}updateTimedVTTCueNodes(this.overlay,this.A),this.B=activeCues}J(regions){if(regions)for(const region of regions){const el=this.M(region);this.j.set(region.id,el),this.overlay.append(el)}}M(region){const el=document.createElement("div");return setPartAttr(el,"region"),setDataAttr(el,"id",region.id),setDataAttr(el,"scroll",region.scroll),setCSSVar(el,"region-width",region.width+"%"),setCSSVar(el,"region-anchor-x",region.regionAnchorX),setCSSVar(el,"region-anchor-y",region.regionAnchorY),setCSSVar(el,"region-viewport-anchor-x",region.viewportAnchorX),setCSSVar(el,"region-viewport-anchor-y",region.viewportAnchorY),setCSSVar(el,"region-lines",region.lines),el}L(cue){const display=document.createElement("div"),position=function computeCuePosition(cue){if("auto"===cue.position)switch(cue.align){case"start":case"left":return 0;case"right":case"end":return 100;default:return 50}return cue.position}(cue),positionAlignment=function computeCuePositionAlignment(cue,dir){if("auto"===cue.positionAlign)switch(cue.align){case"start":return"ltr"===dir?"line-left":"line-right";case"end":return"ltr"===dir?"line-right":"line-left";case"center":return"center";default:return`line-${cue.align}`}return cue.positionAlign}(cue,this.C);if(setPartAttr(display,"cue-display"),""!==cue.vertical&&setDataAttr(display,"vertical"),setCSSVar(display,"cue-text-align",cue.align),cue.style)for(const prop of Object.keys(cue.style))display.style.setProperty(prop,cue.style[prop]);if(this.F(cue))setCSSVar(display,"cue-offset",position-("line-right"===positionAlignment?100:"center"===positionAlignment?50:0)+"%");else if(setCSSVar(display,"cue-writing-mode",""===cue.vertical?"horizontal-tb":"lr"===cue.vertical?"vertical-lr":"vertical-rl"),!cue.style?.["--cue-width"]){let maxSize=position;"line-left"===positionAlignment?maxSize=100-position:"center"===positionAlignment&&position<=50?maxSize=2*position:"center"===positionAlignment&&position>50&&(maxSize=2*(100-position));const size=cue.size<maxSize?cue.size:maxSize;""===cue.vertical?setCSSVar(display,"cue-width",size+"%"):setCSSVar(display,"cue-height",size+"%")}const el=document.createElement("div");return setPartAttr(el,"cue"),cue.id&&setDataAttr(el,"id",cue.id),el.innerHTML=renderVTTCueString(cue),display.append(el),display}F(cue){return cue.region&&100===cue.size&&""===cue.vertical&&"auto"===cue.line}}}}]);