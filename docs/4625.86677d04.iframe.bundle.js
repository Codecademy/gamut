"use strict";(self.webpackChunkgamut_repo=self.webpackChunkgamut_repo||[]).push([[4625],{"./node_modules/@vidstack/react/prod/chunks/vidstack-Dj0oEz46.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HLSProvider:()=>HLSProvider});var _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@vidstack/react/prod/chunks/vidstack-CNjv_Zem.js"),_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@vidstack/react/prod/chunks/vidstack-WyKbSRm0.js");__webpack_require__("./node_modules/react/index.js");class HLSController{#video;#ctx;#instance=null;#stopLiveSync=null;config={};#callbacks=new Set;get instance(){return this.#instance}constructor(video,ctx){this.#video=video,this.#ctx=ctx}setup(ctor){const{streamType}=this.#ctx.$state,isLive=(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.peek)(streamType).includes("live"),isLiveLowLatency=(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.peek)(streamType).includes("ll-");this.#instance=new ctor({lowLatencyMode:isLiveLowLatency,backBufferLength:isLiveLowLatency?4:isLive?8:void 0,renderTextTracksNatively:!1,...this.config});const dispatcher=this.#dispatchHLSEvent.bind(this);for(const event of Object.values(ctor.Events))this.#instance.on(event,dispatcher);this.#instance.on(ctor.Events.ERROR,this.#onError.bind(this));for(const callback of this.#callbacks)callback(this.#instance);this.#ctx.player.dispatch("hls-instance",{detail:this.#instance}),this.#instance.attachMedia(this.#video),this.#instance.on(ctor.Events.AUDIO_TRACK_SWITCHED,this.#onAudioSwitch.bind(this)),this.#instance.on(ctor.Events.LEVEL_SWITCHED,this.#onLevelSwitched.bind(this)),this.#instance.on(ctor.Events.LEVEL_LOADED,this.#onLevelLoaded.bind(this)),this.#instance.on(ctor.Events.LEVEL_UPDATED,this.#onLevelUpdated.bind(this)),this.#instance.on(ctor.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.#onTracksFound.bind(this)),this.#instance.on(ctor.Events.CUES_PARSED,this.#onCuesParsed.bind(this)),this.#ctx.qualities[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.kW.enableAuto]=this.#enableAutoQuality.bind(this),(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.listenEvent)(this.#ctx.qualities,"change",this.#onUserQualityChange.bind(this)),(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.listenEvent)(this.#ctx.audioTracks,"change",this.#onUserAudioChange.bind(this)),this.#stopLiveSync=(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.effect)(this.#liveSync.bind(this))}#createDOMEvent(type,data){return new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent((type=>(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.camelToKebabCase)(type))(type),{detail:data})}#liveSync(){if(!this.#ctx.$state.live())return;const raf=new _vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.e8(this.#liveSyncPosition.bind(this));return raf.start(),raf.stop.bind(raf)}#liveSyncPosition(){this.#ctx.$state.liveSyncPosition.set(this.#instance?.liveSyncPosition??1/0)}#dispatchHLSEvent(type,data){this.#ctx.player?.dispatch(this.#createDOMEvent(type,data))}#onTracksFound(eventType,data){const event=this.#createDOMEvent(eventType,data);let currentTrack=-1;for(let i=0;i<data.tracks.length;i++){const nonNativeTrack=data.tracks[i],init=nonNativeTrack.subtitleTrack??nonNativeTrack.closedCaptions,track=new _vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.to({id:`hls-${nonNativeTrack.kind}-${i}`,src:init?.url,label:nonNativeTrack.label,language:init?.lang,kind:nonNativeTrack.kind,default:nonNativeTrack.default});track[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.Hp.readyState]=2,track[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.Hp.onModeChange]=()=>{"showing"===track.mode?(this.#instance.subtitleTrack=i,currentTrack=i):currentTrack===i&&(this.#instance.subtitleTrack=-1,currentTrack=-1)},this.#ctx.textTracks.add(track,event)}}#onCuesParsed(eventType,data){const index=this.#instance?.subtitleTrack,track=this.#ctx.textTracks.getById(`hls-${data.type}-${index}`);if(!track)return;const event=this.#createDOMEvent(eventType,data);for(const cue of data.cues)cue.positionAlign="auto",track.addCue(cue,event)}#onAudioSwitch(eventType,data){const track=this.#ctx.audioTracks[data.id];if(track){const trigger=this.#createDOMEvent(eventType,data);this.#ctx.audioTracks[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.jH.select](track,!0,trigger)}}#onLevelSwitched(eventType,data){const quality=this.#ctx.qualities[data.level];if(quality){const trigger=this.#createDOMEvent(eventType,data);this.#ctx.qualities[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.jH.select](quality,!0,trigger)}}#onLevelUpdated(eventType,data){data.details.totalduration>0&&this.#ctx.$state.inferredLiveDVRWindow.set(data.details.totalduration)}#onLevelLoaded(eventType,data){if(this.#ctx.$state.canPlay())return;const{type,live,totalduration:duration,targetduration}=data.details,trigger=this.#createDOMEvent(eventType,data);this.#ctx.notify("stream-type-change",live?"EVENT"===type&&Number.isFinite(duration)&&targetduration>=10?"live:dvr":"live":"on-demand",trigger),this.#ctx.notify("duration-change",duration,trigger);const media=this.#instance.media;-1===this.#instance.currentLevel&&this.#ctx.qualities[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.kW.setAuto](!0,trigger);for(const remoteTrack of this.#instance.audioTracks){const localTrack={id:remoteTrack.id.toString(),label:remoteTrack.name,language:remoteTrack.lang||"",kind:"main"};this.#ctx.audioTracks[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.jH.add](localTrack,trigger)}for(const level of this.#instance.levels){const videoQuality={id:level.id?.toString()??level.height+"p",width:level.width,height:level.height,codec:level.codecSet,bitrate:level.bitrate};this.#ctx.qualities[_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.jH.add](videoQuality,trigger)}media.dispatchEvent(new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent("canplay",{trigger}))}#onError(eventType,data){if(data.fatal)if("mediaError"===data.type)this.#instance?.recoverMediaError();else this.#onFatalError(data.error)}#onFatalError(error){this.#ctx.notify("error",{message:error.message,code:1,error})}#enableAutoQuality(){this.#instance&&(this.#instance.currentLevel=-1)}#onUserQualityChange(){const{qualities}=this.#ctx;this.#instance&&!qualities.auto&&(this.#instance[qualities.switch+"Level"]=qualities.selectedIndex,_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.G_&&(this.#video.currentTime=this.#video.currentTime))}#onUserAudioChange(){const{audioTracks}=this.#ctx;this.#instance&&this.#instance.audioTrack!==audioTracks.selectedIndex&&(this.#instance.audioTrack=audioTracks.selectedIndex)}onInstance(callback){return this.#callbacks.add(callback),()=>this.#callbacks.delete(callback)}loadSource(src){(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isString)(src.src)&&this.#instance?.loadSource(src.src)}destroy(){this.#instance?.destroy(),this.#instance=null,this.#stopLiveSync?.(),this.#stopLiveSync=null}}class HLSLibLoader{#lib;#ctx;#callback;constructor(lib,ctx,callback){this.#lib=lib,this.#ctx=ctx,this.#callback=callback,this.#startLoading()}async#startLoading(){const callbacks={onLoadStart:this.#onLoadStart.bind(this),onLoaded:this.#onLoaded.bind(this),onLoadError:this.#onLoadError.bind(this)};let ctor=await async function loadHLSScript(src,callbacks={}){if(!(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isString)(src))return;callbacks.onLoadStart?.();try{if(await(0,_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.k0)(src),!(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isFunction)(window.Hls))throw Error("");const ctor=window.Hls;return callbacks.onLoaded?.(ctor),ctor}catch(err){callbacks.onLoadError?.(err)}return}(this.#lib,callbacks);if((0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isUndefined)(ctor)&&!(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isString)(this.#lib)&&(ctor=await async function importHLS(loader,callbacks={}){if((0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isUndefined)(loader))return;if(callbacks.onLoadStart?.(),loader.prototype&&loader.prototype!==Function)return callbacks.onLoaded?.(loader),loader;try{const ctor=(await loader())?.default;if(!ctor||!ctor.isSupported)throw Error("");return callbacks.onLoaded?.(ctor),ctor}catch(err){callbacks.onLoadError?.(err)}return}(this.#lib,callbacks)),!ctor)return null;if(!ctor.isSupported()){const message="[vidstack] `hls.js` is not supported in this environment";return this.#ctx.player.dispatch(new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent("hls-unsupported")),this.#ctx.notify("error",{message,code:4}),null}return ctor}#onLoadStart(){this.#ctx.player.dispatch(new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent("hls-lib-load-start"))}#onLoaded(ctor){this.#ctx.player.dispatch(new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent("hls-lib-loaded",{detail:ctor})),this.#callback(ctor)}#onLoadError(e){const error=(0,_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.rv)(e);this.#ctx.player.dispatch(new _vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.DOMEvent("hls-lib-load-error",{detail:error})),this.#ctx.notify("error",{message:error.message,code:4,error})}}class HLSProvider extends _vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.Nw{$$PROVIDER_TYPE="HLS";#ctor=null;#controller=new HLSController(this.video,this.ctx);get ctor(){return this.#ctor}get instance(){return this.#controller.instance}static supported=(0,_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.m0)();get type(){return"hls"}get canLiveSync(){return!0}#library="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js";get config(){return this.#controller.config}set config(config){this.#controller.config=config}get library(){return this.#library}set library(library){this.#library=library}preconnect(){(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isString)(this.#library)&&(0,_vidstack_WyKbSRm0_js__WEBPACK_IMPORTED_MODULE_2__.TB)(this.#library)}setup(){super.setup(),new HLSLibLoader(this.#library,this.ctx,(ctor=>{this.#ctor=ctor,this.#controller.setup(ctor),this.ctx.notify("provider-setup",this);const src=(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.peek)(this.ctx.$state.source);src&&this.loadSource(src)}))}async loadSource(src,preload){(0,_vidstack_CNjv_Zem_js__WEBPACK_IMPORTED_MODULE_1__.isString)(src.src)?(this.media.preload=preload||"",this.appendSource(src,"application/x-mpegurl"),this.#controller.loadSource(src),this.currentSrc=src):this.removeSource()}onInstance(callback){const instance=this.#controller.instance;return instance&&callback(instance),this.#controller.onInstance(callback)}destroy(){this.#controller.destroy()}}}}]);